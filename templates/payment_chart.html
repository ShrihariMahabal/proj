<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Page</title>
    <link href="{{url_for('static',filename='css/output.css')}}" rel="stylesheet">
    <link rel="stylesheet" href="{{url_for('static',filename='css/index.css')}}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #myPieChart {
            max-width: 100%;
            max-height: 100%;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="flex justify-start items-center">
            <a href="{{url_for('group_page',gid=gid)}}">
                <img class="h-8 w-8 m-2" src="{{url_for('static',filename='arrow-left-black.svg')}}" alt="">
            </a>
        </div>

        <div class="grp-info-container flex justify-center">
            <div class="grp-info flex space-x-6">
                <img class="w-[5rem] h-[5rem]" src="{{url_for('static',filename='icons8-group-96.png')}}" alt="">
                <div class="flex flex-col justify-center">
                    <h1 class="font-mont font-bold text-2xl">{{group_name}}</h1>
                    <div class="copy-text">
                        <p class="invite-heading text-md">Invite Code:</p>
                        <div class="invite-text flex border-[1px] border-black rounded-lg mb-3 mt-1">
                            <input class="rounded-lg text-[#555] text-sm text-center" size="3" type="text" id="txt"
                                value="{{invite_code}}" readonly>
                            <button
                                class="relative flex justify-center items-center bg-accent rounded-lg p-1 active:bg-[#809ce2] before:content-['Copied'] before:absolute before:top-[-2.2rem] before:right--1 before:bg-[#5c81dc] before:px-1 before:rounded-lg before:text-white before:hidden  cpy-btn">
                                <img src="{{url_for('static',filename='copy.svg')}}" alt="">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="mb-3 mx-4 flex justify-between">
            <h1 class="font-mont font-semibold text-[1.7rem]" >Group Members Payment Chart</h1>
          </div>

        <div class="h-[25vh] flex flex-col justify-center space-y-4 items-center bg-white rounded-b-3xl shadow-lg" >
            <canvas id="myPieChart"></canvas>
        </div>

        <div class="h-[25vh] flex flex-col justify-center space-y-4 items-center bg-white rounded-b-3xl shadow-lg">
            <h1 class="font-semibold font-pop text-xl">Total Amount Paid in the Group= Rs.{{total_payment}}</h1>
      </div>


        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const ctxp = document.getElementById('myPieChart');
                const chart_data = JSON.parse('{{ chart_data | tojson | safe }}');
        
                // Object to store accumulated amounts for each payer username
                const amountsByUser = {};

                // Loop through the chart data and accumulate amounts for each payer username
                chart_data.forEach(data => {
                    const username = data.username;
                    const amount = data.amount;
                    if (amountsByUser.hasOwnProperty(username)) {
                        amountsByUser[username] += amount;
                    } else {
                        amountsByUser[username] = amount;
                    }
                });

                const labels = Object.keys(amountsByUser);
                const amounts = Object.values(amountsByUser);
        
                new Chart(ctxp, {
                    type: 'pie',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Amount Paid',
                            data: amounts,
                            backgroundColor: [
                                'rgb(255, 99, 132)',
                                'rgb(54, 162, 235)',
                                'rgb(255, 205, 86)',
                                'rgb(205, 205, 255)',
                                'rgb(86, 205, 86)',
                                'rgb(162, 162, 86)',
                                'rgb(132, 205, 99)',
                                'rgb(54, 235, 86)'
                            ],
                            hoverOffset: 4
                        }]
                    },
                });
            });
        </script>

        {% include 'nav.html' %}
    </div>
</body>

</html>